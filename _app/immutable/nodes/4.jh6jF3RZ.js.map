{"version":3,"file":"4.jh6jF3RZ.js","sources":["../../../../../../src/lib/google/sheets/index.ts","../../../../../../src/routes/(main)/leaderboard/+layout.ts","../../../../../../src/routes/(main)/leaderboard/+layout.svelte"],"sourcesContent":["import type { sheets_v4 } from 'googleapis'\n\nexport function filterHeaders(headers: Sheet.RaidTitle[]) {\n    return headers.filter((cell) => cell as string !== \"\")\n}\n\nexport function parseSheetData(headers: Sheet.RaidTitle[], valueRanges?: sheets_v4.Schema$ValueRange[]): Sheet.RaidGroup<typeof headers[number]> {\n    const cellHeaders = [\n        \"Entry Tag\",\n        \"Entry Date\",\n        \"Username\",\n        \"Score\",\n        \"Portray\",\n        \"Resonance\",\n        \"Amplification\",\n        \"Name\"\n    ]\n    const entryMeta = cellHeaders.slice(0, 4) as (\"Entry Tag\" | \"Entry Date\" | \"Username\" | \"Score\")[]\n\n    return headers?.reduce((accumulator, header, index) => {\n        if (valueRanges?.[index]) {\n            const values: Sheet.Entry[][] = valueRanges[index].values?.reduce((rowAccumulator, row, rowIndex) => {\n                let entry: Record<typeof cellHeaders[number], any> = {}\n                const characters = [row.slice(4, 8), row.slice(8, 12), row.slice(12, 16), row.slice(16, 20)].map((characterData, characterIndex) => {\n                    let charaObject: Record<string, string> = {}\n                    if (characterData[0] || characterData[1] || characterData[2] || characterData[3]) {\n                        charaObject[cellHeaders[4]] = characterData[0]\n                        charaObject[cellHeaders[5]] = characterData[1]\n                        charaObject[cellHeaders[6]] = characterData[2]\n                        charaObject[cellHeaders[7]] = characterData[3]\n                        return charaObject\n                    }\n                }).filter((characters) => characters !== undefined)\n\n                entryMeta.forEach((meta, metaIndex) => {\n                    if (meta === 'Score') {\n                        row[metaIndex] = Number(row[metaIndex].replace(/,/g, ''))\n                    }\n                    if (meta === 'Entry Date') {\n                        row[metaIndex] = new Date(row[metaIndex])\n                    }\n                    entry[meta] = row[metaIndex]\n                })\n                \n                entry.characters = characters\n                rowAccumulator.push(entry)\n                return rowAccumulator\n            }, []) ?? []\n\n            valueRanges[index].values = values\n            accumulator[header] = valueRanges[index] as Sheet.RaidData\n        }\n        return accumulator\n    }, {} as Sheet.RaidGroup<Sheet.RaidTitle>)\n}\n","import { PUBLIC_LAMY_API_GOOGLE_SHEETS_API_KEY, PUBLIC_GLOBAL_RANKING_SPREADSHEET_ID } from \"$env/static/public\"\nimport { parseSheetData, filterHeaders } from \"$lib/google/sheets\"\n\nexport const load = async ({ fetch }) => {\n    const sheet: Promise<{\n        headers: Sheet.RaidTitle[],\n        f2p: Sheet.RaidGroup<Sheet.RaidTitle>,\n        ffa: Sheet.RaidGroup<Sheet.RaidTitle>,\n        raidGroup: Sheet.RaidTitle[]\n    }> = new Promise(async (resolve, reject) => {\n        try {\n            const sheetResponse = await fetch(`https://sheets.googleapis.com/v4/spreadsheets/${PUBLIC_GLOBAL_RANKING_SPREADSHEET_ID}/values/F2P!B8:8?majorDimension=ROWS&key=${PUBLIC_LAMY_API_GOOGLE_SHEETS_API_KEY}`)\n            const headers = sheetResponse.status === 200 ? filterHeaders((await sheetResponse.json())?.values[0] ?? []) : []\n\n            if (headers.length > 0) {\n                const f2pResponse = await fetch(`https://sheets.googleapis.com/v4/spreadsheets/${PUBLIC_GLOBAL_RANKING_SPREADSHEET_ID}/values:batchGet?ranges=F2P!C10:V&ranges=F2P!Y10:AR&ranges=F2P!AU10:BN&ranges=F2P!BQ10:CJ&ranges=F2P!CM10:DF&majorDimension=ROWS&key=${PUBLIC_LAMY_API_GOOGLE_SHEETS_API_KEY}`)\n                const f2p = parseSheetData(headers, (await f2pResponse.json()).valueRanges)\n\n                const ffaResponse = await fetch(`https://sheets.googleapis.com/v4/spreadsheets/${PUBLIC_GLOBAL_RANKING_SPREADSHEET_ID}/values:batchGet?ranges=FFA!C10:V&ranges=FFA!Y10:AR&ranges=FFA!AU10:BN&ranges=FFA!BQ10:CJ&ranges=FFA!CM10:DF&majorDimension=ROWS&key=${PUBLIC_LAMY_API_GOOGLE_SHEETS_API_KEY}`)\n                const ffa = parseSheetData(headers, (await ffaResponse.json()).valueRanges)\n\n                const raidGroup = Object.keys(f2p) as Sheet.RaidTitle[]\n                resolve({ headers, f2p, ffa, raidGroup })\n            }\n        } catch (error) {\n            if (error instanceof Error) {\n                reject(error.message)\n            } else {\n                reject(String(error))\n            }\n        }\n    })\n\n    return {\n        sheet\n    }\n}\n","<script lang=\"ts\">\n    import '$lib/app.css'\n\n    import { page } from '$app/stores'\n    import { base } from '$app/paths'\n    import { onNavigate } from '$app/navigation'\n    import { raidGroup } from '$lib/data'\n\n    import LoadingSpinner from '$lib/components/LoadingSpinner.svelte'\n    \n    let { data, children } = $props()\n    let search = $state(window.location.search)\n\n    const raidMap: Record<Sheet.RaidTitle, { thumbnail: string }> = {\n        \"Darkness of the Abyss\": {\n            thumbnail: `${base}/img/ui/darkness-of-the-abyss.webp`\n        },\n        \"Marsh Creation\": {\n            thumbnail: `${base}/img/ui/marsh-creation.webp`\n        },\n        \"Gold in the Cave\": {\n            thumbnail: `${base}/img/ui/gold-in-the-cave.webp`\n        },\n        \"Hypothesis of Exhibition\": {\n            thumbnail: `${base}/img/ui/hypothesis-of-exhibition.webp`\n        },\n        \"Projection of Nightmare\": {\n            thumbnail: `${base}/img/ui/projection-of-nightmare.webp`\n        }\n    }\n    // const raidGroup = Object.keys(data.f2p) as Sheet.RaidTitle[]\n\n    onNavigate(() => {\n        search = window.location.search\n    })\n</script>\n\n<svelte:head>\n    <link rel=\"stylesheet\" href=\"{base}/css/leaderboard.css\">\n</svelte:head>\n\n<div class=\"flex-grow md:px-20 py-6 pt-20 md:pt-6 space-y-6\">\n    <h2 class=\"crimson-text-bold text-tuscany-600 dark:text-white text-3xl px-10 md:px-0\">Mane's Bulletin Leaderboard</h2>\n\n    <div class=\"flex flex-col md:flex-row gap-4\">\n        <!-- class:hidden={!raidGroup.map((raid) => raid.toLowerCase().split(\" \").join(\"-\")).includes($page.url.pathname.replace('/leaderboard/', ''))} -->\n        <aside class=\"flex-shrink-0 sticky top-6 z-10 md:z-[9] backdrop-blur-sm md:backdrop-blur-none px-10 md:px-0\">\n            <!-- [&:has(.spinner)]:h-full [&:has(.spinner)]:justify-center -->\n            <div class=\"raid-nav sticky min-w-[180px] top-[9rem] flex md:flex-col gap-2 md:top-20\">\n                <!-- https://10015.io/tools/css-loader-generator -->\n                {#await data.sheet}\n                    <LoadingSpinner class=\"self-center\" />\n                {:then sheet}\n                    {#each sheet.raidGroup as raid, index}\n                        <a data-sveltekit-noscroll href=\"{base}/leaderboard/{$page.route.id?.replace('/(main)/leaderboard/', '').replace('/[raid=raid]', '')}/{raid.toLowerCase().split(\" \").join(\"-\")}{search}\" style=\"--animation-order: {index + 1};\" class=\"raid-link {$page.params.raid === raid.toLowerCase().split(\" \").join(\"-\") ? 'bg-tuscany-600 text-white' : ''} whitespace-nowrap outline-none hover:text-white focus:text-white hover:bg-tuscany-500 focus:bg-tuscany-500 dark:hover:bg-tuscany-400 dark:focus:bg-tuscany-400 p-0.5 md:px-2 md:py-1\">\n                            {#if raidMap[raid].thumbnail}\n                                <img src=\"{raidMap[raid].thumbnail}\" alt=\"{raid}\" loading=\"lazy\" class=\"w-10 h-10 aspect-square md:hidden\">\n                            {/if}\n                            <div class=\"sr-only md:not-sr-only\">\n                                {raid}\n                            </div>\n                        </a>\n                    {/each}\n                {/await}\n            </div>\n        </aside>\n\n        {@render children()}\n    </div>\n</div>\n\n<style>\n    .raid-link {\n        opacity: 0;\n        transform: translateX(-1rem);\n        animation-name: fade-in;\n        animation-duration: 400ms;\n        animation-timing-function: ease-in;\n        animation-delay: calc(200ms * var(--animation-order));\n        animation-fill-mode: forwards;\n    }\n\n    @keyframes fade-in {\n        0% {\n            opacity: 0;\n            transform: translateX(-1rem);\n        }\n        100% {\n            opacity: 1;\n            transform: translateX(0);\n        }\n    }\n</style>\n"],"names":["filterHeaders","headers","cell","parseSheetData","valueRanges","cellHeaders","entryMeta","accumulator","header","index","values","_a","rowAccumulator","row","rowIndex","entry","characters","characterData","characterIndex","charaObject","meta","metaIndex","load","fetch","resolve","reject","sheetResponse","PUBLIC_GLOBAL_RANKING_SPREADSHEET_ID","PUBLIC_LAMY_API_GOOGLE_SHEETS_API_KEY","f2pResponse","f2p","ffaResponse","ffa","raidGroup","error","search","$.source","$.proxy","raidMap","base","onNavigate","$.set","sheet","$.index","$$anchor","raid","stringified_text_1","$.derived","$page","$.set_attribute","a","$.unwrap","$.template_effect","$.set_class"],"mappings":"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"}